import React, { useEffect, useState } from "react";
import io from "socket.io-client";
import DisplayStreamsData from "./StreamsGraph"
import Header from "../HomePage/HomeComponents/HomeHeader";

interface StreamData {
  time: number[];
  values: string[];
  decimalValues: string[];
  senders: string[];
  receivers: string[];
  averageValue: number;
}

const initializeStreamData = () => {
  const size = 100;
  return {
    time: Array(size).fill(0),
    values: Array(size).fill(""),
    decimalValues: Array(size).fill(""),
    senders: Array(size).fill(""),
    receivers: Array(size).fill(""),
    averageValue: 0,
  };
};

const testData = {
  time: [1709151937940,
    1709151937941,
    1709151937941,
    1709151937941,
    1709151937941,
    1709151937941,
    1709151937941,
    1709151937941,
    1709151937941,
    1709151937941,
    1709151937941,
    1709151937942,
    1709151937942,
    1709151937942,
    1709151937942,
    1709151937942,
    1709151937942,
    1709151937942,
    1709151937942,
    1709151937942,
    1709151937942,
    1709151937943,
    1709151942285,
    1709151942286,
    1709151942286,
    1709151942287,
    1709151942288,
    1709151942288,
    1709151942289,
    1709151942289,
    1709151942289,
    1709151942289,
    1709151942289,
    1709151942289,
    1709151942289,
    1709151942289,
    1709151942290,
    1709151942290,
    1709151942290,
    1709151942290,
    1709151942290,
    1709151942290,
    1709151942290,
    1709151946277,
    1709151946277,
    1709151946278,
    1709151946279,
    1709151946279,
    1709151946280,
    1709151946280,
    1709151946281,
    1709151946281,
    1709151946281,
    1709151946281,
    1709151946281,
    1709151946281,
    1709151946281,
    1709151946281,
    1709151946281,
    1709151946281,
    1709151946281,
    1709151946282,
    1709151946282,
    1709151946282,
    1709151946282,
    1709151946282,
    1709151946282,
    1709151946282,
    1709151946282,
    1709151946282,
    1709151957505,
    1709151957506,
    1709151957507,
    1709151957508,
    1709151957508,
    1709151957509,
    1709151957509,
    1709151957510,
    1709151957510,
    1709151957510,
    1709151957510,
    1709151957510,
    1709151957510,
    1709151957510,
    1709151957510,
    1709151957510,
    1709151957511,
    1709151957511,
    1709151978867,
    1709151978868,
    1709151978869,
    1709151978870,
    1709151978871,
    1709151978871,
    1709151978872,
    1709151978872,
    1709151978872,
    1709151978872,
    1709151978872,
    1709151978872],
  receivers: [  "0x1ab4973a48dc892cd9971ece8e01dcc7688f8f23",
  "0xa88f86e5685fca7c5d6de0e4d944875b007137b5",
  "0x983873529f95132bd1812a3b52c98fb271d2f679",
  "0x537d79bd85bc8aa7a97a04be0f904a9e665291fe",
  "0x9e6603ff1194640eebee855f9e11297db2e89af4",
  "0x2d6c2eefc66db8fab3ee999706af74d6ae3b9581",
  "0xe4f8d77e5ff4ab30aedccbfdc5d2cbe9f15625f9",
  "0x52129828bfb13407f8e98e0bcf64c2472adfe529",
  "0x719b4cb74eba5f1e493643c67363115ca9510063",
  "0x0074d68b4d9d140a12b0aab4ee836af764f1446b",
  "0xbb6ba836b3986f0799c34f7751578cd600bc64ef",
  "0x488d19d5c481df9f86b416a97836041da5917ff6",
  "0xca87acb6c7a230518dbefcf6fee14d8bd94b1756",
  "0xaeecd855bacb9b0181644106065f61274818c813",
  "0x0cc98deea31c9413677cb72921683fe1636db7c9",
  "0xfb8081ba0706213083f537696a691dec54f1a814",
  "0xd0635af9f57933ba10b246b521b264866a43c628",
  "0xa9d1e08c7793af67e9d92fe308d5697fb81d3e43",
  "0xa9d1e08c7793af67e9d92fe308d5697fb81d3e43",
  "0x2df9b935c44057ac240634c7536511d8aa03028d",
  "0xbc213a76a65f540667682d1d1a3a4dfedee489fc",
  "0x11381cd3dc649cba9344cad2cf36e71fe6de873d",
  "0x6b75d8af000000e20b7a7ddf000ba900b4009a80",
  "0x1111111254eeb25477b68fb85ed929f73a960582",
  "0xff29d3e552155180809ea3a877408a4620058086",
  "0x11b815efb8f581194ae79006d24e0d814b7697f6",
  "0xc7bbec68d12a0d1830360f8ec58fa599ba1b0e9b",
  "0x235d3afac42f5e5ff346cb6c19af13194988551f",
  "0xa88800cd213da5ae406ce248380802bd53b47647",
  "0x3d29e79dab6e3f9fd0000cf7598d47b60e352286",
  "0xc4396ef79723477751c6092d384cb0b5591705f2",
  "0x1236b176d2f2326bfc12cfd765583fdaad3291ba",
  "0x89e51fa8ca5d66cd220baed62ed01e8951aa7c40",
  "0xf9a72da9c4ca8905897b548974aec89be0e54f89",
  "0xd7aa9ba6caac7b0436c91396f22ca5a7f31664fc",
  "0xa6e618f2cf78297af7f1f90c0c21e1a174942bae",
  "0x12e4a93d3bcac0e9e59b547f492c9c27ed7999be",
  "0xbeb5fd030ffb0fbc95d68113c1c796eff65526d7",
  "0x2ce910fbba65b454bbaf6a18c952a70f3bcd8299",
  "0xed73a6ff24a3fae0f6589225b49c4ee5dff3b254",
  "0xa22bac86e8f721875c6be26c1fc0b021442f7279",
  "0x995ce399ac4a4dcd0865d9d70f051b56efa85da2",
  "0x3ed3b47dd13ec9a98b44e6204a523e766b225811",
  "0x98c3d3183c4b8a650614ad179a1a98be0a8d6b8e",
  "0x1935001ff1512107fd1558222fad63c1aa98b33e",
  "0x1bfb2436a83d8a42442052a8517970f872b0c530",
  "0x84a7cd559ff3608ce1ee904abe2d7f951eb5dc22",
  "0x49f0180766e61e4a666b9f59776807a921670cb8",
  "0x08daf71efa7915807bc5675ad402989d7820cf6f",
  "0x7409ffb7951c2520c531375e9d9d8f399ddb2fd3",
  "0x50931bd82e9f17f87e5f593b597c2952174123fc",
  "0x0703d04d30848a34b40a38537e88286cd39a32e6",
  "0xbf3dbb87accef57dbedccdf4af3e9cc6e5fa8b63",
  "0x10fc5af0b4716c9b05b4ea44ae172aa4d93de2b5",
  "0xa3db557404bd9a74ac14c36f41316ed04acb144c",
  "0x254c18e634cbdf58f60ea83064fb39c75dfa6749",
  "0x9cb24a0e90134122b7f7f1f70a604a456b92f8e4",
  "0x27fd43babfbe83a81d14665b1a6fb8030a60c9b4",
  "0xdc82164631d65c98378dc74b3baf05856fdf9a92",
  "0x875f0686ba77e597113a64a9fd9dbbc8bd2c496d",
  "0x78066c43c32e0bdb23a3fc135e9fe0160ff657c5",
  "0x2b5431e034ace47318edfdd4f693224562c27c6e",
  "0x725fdf7b8362d0bae227ea04d9c0037014209848",
  "0x195c0034d23d270a8c8a88272c70d09e8dae368b",
  "0xb97b1d5d42e3bf4d4310a16a54f528bc37ab697f",
  "0xf081470f5c6fbccf48cc4e5b82dd926409dcdd67",
  "0x435664008f38b0650fbc1c9fc971d0a3bc2f1e47",
  "0x6058e60d5f281851d0de05f2250ca6fdd62272ea",
  "0x44f5b66b4bad1a423319b7456ee260f3bf15e8b5",
  "0x8315b4729253c57e4d4a6c3809a9dd1fd5dc9a16",
  "0x53facee52e897740b140f5304e9cd9dc6238d735",
  "0x390f3595bca2df7d23783dfd126427cceb997bf4",
  "0x9008d19f58aabd9ed0d60971565aa8510560ab41",
  "0xfbb8776298d34f64950f45ac7ba943b45794c39b",
  "0x4a14347083b80e5216ca31350a2d21702ac3650d",
  "0xf0473f9797d2ebd2998764468fc8e90b1c0fbc01",
  "0x051acf8d69a18d6a6e4dd063b39501e69704ac50",
  "0x39ebd27ce38f721740097329ff0f9ae5f643121d",
  "0x48d1cdc10a3347859d4b92535b4749157a1b2d07",
  "0x5770815b0c2a09a43c9e5aecb7e2f3886075b605",
  "0x8d1f2ebfaccf1136db76fdd1b86f1dede2d23852",
  "0x7f0d9a9af9879cd5e0bb47cf7bf32dd3fb45575f",
  "0x1f410949b702b4367b9f873a9e0f1d66a0c213ed",
  "0x8142d2c5fae4ed8011526e2262276fe2e3a755b2",
  "0xc1b90d3fa636bcac46fa84c3dc4a76d354f9925f",
  "0x9c0f59aa6b9955660c1a2f28b70a2c5d96118dee",
  "0xd255b741581aad35e3254f50b22b48596dfa022a",
  "0x916ebd481ede2b814c164c2e392807a68d6332ba",
  "0x6c99b0790070b9feca6826be42778f025ffde72c",
  "0x897b425dab19eb886dc6ae2010fe2a0de85308fa",
  "0x95a0db1bd07552e093fa120c6f10c1a084f1e620",
  "0x544de72fcfb1149bf171028f820cffcf3617d2a9",
  "0x7a685dcf2fd1a55709287b4b56650199ce8b523d",
  "0xc2ff755b76682f7a8c7d26fa1ba808ffbcd2d090",
  "0xf63f67d9485af50cca0f5772a0a971fd1698e7b5",
  "0x27c72c5998d3486b86c0387f3965aeecd7965c34",
  "0x37e9b21142523893f1f76073787d92206062f2a8",
  "0x9a11dcb4b1092405fba99f47eb4b29247e54413f",
  "0xa4a9f0b4c862c9a679a56a725b6c1c1abdb4fa26",
  "0x4b8e2cac23e0a764ad113bac9f87c96d2da0f054"],
  senders: ["0xb2e21945e82f752e346524f1042bb83e541de261",
  "0x9e8aff090f60385dd52f67fcc9f7e3be60b5c9c5",
  "0xd67fc62f958d65c400a8d40c01e44d7ef96eafbb",
  "0x87cbc48075d7aa1760ac71c41e8bc289b6a31f56",
  "0xa9d1e08c7793af67e9d92fe308d5697fb81d3e43",
  "0xa9d1e08c7793af67e9d92fe308d5697fb81d3e43",
  "0xa9d1e08c7793af67e9d92fe308d5697fb81d3e43",
  "0xa9d1e08c7793af67e9d92fe308d5697fb81d3e43",
  "0xa9d1e08c7793af67e9d92fe308d5697fb81d3e43",
  "0xa9d1e08c7793af67e9d92fe308d5697fb81d3e43",
  "0xa9d1e08c7793af67e9d92fe308d5697fb81d3e43",
  "0xa9d1e08c7793af67e9d92fe308d5697fb81d3e43",
  "0x9696f59e4d72e237be84ffd425dcad154bf96976",
  "0x56eddb7aa87536c09ccc2793473599fd21a8b17f",
  "0x28c6c06298d514db089934071355e5743bf21d60",
  "0xa690621b1d2f8cc06de2de11e4cf69935f82655a",
  "0xa8907d9a42f8b6ee94fdb91ad668d33e215c8133",
  "0x6fe684d84706ca53fd9a8636af65b40e32623d4d",
  "0x07fcdce923f00a323039c3043bbcca3fe8c8e2a9",
  "0x2704e5bff986616fd4cdf41eff92dcc5855bfdfc",
  "0x2213e1f15e8ea3956b376b0752a867743e52ba65",
  "0x37a8ce97efbfb757384b6c043259bba4155afac2",
  "0xc7bbec68d12a0d1830360f8ec58fa599ba1b0e9b",
  "0xc7bbec68d12a0d1830360f8ec58fa599ba1b0e9b",
  "0x1111111254eeb25477b68fb85ed929f73a960582",
  "0xdeb5975f8ae89aeac72cf22d1a28152ea34f076c",
  "0x6b75d8af000000e20b7a7ddf000ba900b4009a80",
  "0x655edce464cc797526600a462a8154650eee4b77",
  "0x235d3afac42f5e5ff346cb6c19af13194988551f",
  "0xa88800cd213da5ae406ce248380802bd53b47647",
  "0x0b5c4a7fcda49e0a8661419bb55b86161a86db2a",
  "0x6d92b01c9f8718e0e4fd54d704f3c9e87666faca",
  "0xd2d962ddae2b09f855e2be3ff5c10189f0807484",
  "0x1e4738fa27123ccaa558e1dc020a78353f7bc280",
  "0xdaa1c780fb2787c4169ed369827cd9c230d70048",
  "0x39f6a6c85d39d5abad8a398310c52e7c374f2ba3",
  "0x9c29418129553be171181bb6245151aa0576a3b7",
  "0x060b9dabe80e32cb1351b0ff756a950b6a7d26e5",
  "0x5041ed759dd4afc3a72b8192c143f72f4724081a",
  "0x0a8393c939ca91ffaae9924e3850c34fffd47716",
  "0x51d2c4abdf244bc9eed0f0ca792009c5de636fb9",
  "0xea66b167a0798ed24189e4f21f102936ef5e978e",
  "0x219e2a6f18fa94e8756c7d277c5e11f00de56eee",
  "0xff29d3e552155180809ea3a877408a4620058086",
  "0xb9e2dc9c02560531a84923341cb1d5857fc4a2d8",
  "0x501a2b64afa03074472b6cec9293c2395e48e2b2",
  "0x46340b20830761efd32832a74d7169b29feb9758",
  "0x46340b20830761efd32832a74d7169b29feb9758",
  "0x25a9f4da0dc980dfcd75ffbfbf1d0c3e480b4247",
  "0x56eddb7aa87536c09ccc2793473599fd21a8b17f",
  "0x0d0707963952f2fba59dd06f2b425ace40b492fe",
  "0xee2119a6260af409e7f37a0fdcda26ffb3b4a7fa",
  "0x32ceb879c8b90c4caa06524b6fe25a1cf6c21b5b",
  "0x21a31ee1afc51d94c2efccaa2092ad1028285549",
  "0x28c6c06298d514db089934071355e5743bf21d60",
  "0x9696f59e4d72e237be84ffd425dcad154bf96976",
  "0xf60c2ea62edbfe808163751dd0d8693dcb30019c",
  "0x8c304679f3616c092d8cae4ea87764276031af14",
  "0x1ab4973a48dc892cd9971ece8e01dcc7688f8f23",
  "0x1ab4973a48dc892cd9971ece8e01dcc7688f8f23",
  "0x1ab4973a48dc892cd9971ece8e01dcc7688f8f23",
  "0xa294cca691e4c83b1fc0c8d63d9a3eef0a196de1",
  "0x8195d3496305d2dbe43b21d51e6cc77b6c9c8364",
  "0x808d0aee8db7e7c74faf4b264333afe8c9ccdba4",
  "0x808d0aee8db7e7c74faf4b264333afe8c9ccdba4",
  "0x3416cf6c708da44db2624d63ea0aaef7113527c6",
  "0xf081470f5c6fbccf48cc4e5b82dd926409dcdd67",
  "0x46340b20830761efd32832a74d7169b29feb9758",
  "0x11b815efb8f581194ae79006d24e0d814b7697f6",
  "0xbf3fd6edca1518bdd59acbdd0ec379069d1d57fa",
  "0x435664008f38b0650fbc1c9fc971d0a3bc2f1e47",
  "0x53facee52e897740b140f5304e9cd9dc6238d735",
  "0x51c72848c68a965f66fa7a88855f9f7784502a7f",
  "0x9008d19f58aabd9ed0d60971565aa8510560ab41",
  "0xc7bbec68d12a0d1830360f8ec58fa599ba1b0e9b",
  "0x4a14347083b80e5216ca31350a2d21702ac3650d",
  "0x080c3eb53ba0b741d16ad551bd1046853e79e557",
  "0x1ab4973a48dc892cd9971ece8e01dcc7688f8f23",
  "0xcfc0f98f30742b6d880f90155d4ebb885e55ab33",
  "0xf68ba573fedaa833b089c3c78ba3984e35c5321c",
  "0x6aaad8b07837c201805878b208edd76656d80963",
  "0x9696f59e4d72e237be84ffd425dcad154bf96976",
  "0x56eddb7aa87536c09ccc2793473599fd21a8b17f",
  "0x21a31ee1afc51d94c2efccaa2092ad1028285549",
  "0x3f46845e3b7e16ccc2b59f6791eddeff7b162df1",
  "0x47da741e9fada9aff75c0f2df69e9cd2b216b225",
  "0xd59d53250e6dc0efad7bc1e6b5e6a14f7525a155",
  "0x6e095bf9950b21786bf03649d1395d37a2faebdb",
  "0x3d42962727a8c8b000f392e8e8fc111b1619522b",
  "0xbe06d2a718013e0da0ed9e00b74996b92133ebf1",
  "0x75e89d5979e4f6fba9f97c104c2f0afb3f1dcb88",
  "0x75e89d5979e4f6fba9f97c104c2f0afb3f1dcb88",
  "0x75e89d5979e4f6fba9f97c104c2f0afb3f1dcb88",
  "0x75e89d5979e4f6fba9f97c104c2f0afb3f1dcb88",
  "0x0802dd2edd3f9fad39a9173b4595be819f201d61",
  "0x46340b20830761efd32832a74d7169b29feb9758",
  "0x46340b20830761efd32832a74d7169b29feb9758",
  "0x6c69fa64ec451b1bc5b5fbaa56cf648a281634be",
  "0x9696f59e4d72e237be84ffd425dcad154bf96976",
  "0x56eddb7aa87536c09ccc2793473599fd21a8b17f"],
  values: [ "1022690000",
  "80354713",
  "2000000000",
  "299424850",
  "60000000",
  "108593551",
  "399778123",
  "600084864",
  "739589528",
  "836279157",
  "8178909472",
  "50000000000",
  "542000000",
  "5920105000",
  "1012060192",
  "1090000000",
  "15985000000",
  "7039630000",
  "11893726326",
  "680987030",
  "30000000000",
  "930000000",
  "217700859393",
  "10413924106",
  "10413924106",
  "12552294821",
  "217700859136",
  "1162862900",
  "1124726727",
  "1124726727",
  "105320000",
  "1804236553",
  "187729000000",
  "94940000",
  "187989007",
  "7798632226",
  "1000000000",
  "5959974233",
  "1785098930000",
  "59850000",
  "747260200",
  "1740510996",
  "22523575090",
  "7154570226",
  "242000000",
  "216790000",
  "1990000000",
  "13578234028",
  "5000000000",
  "450450000",
  "145866490",
  "815161604",
  "850000000",
  "7985000000",
  "15588559500",
  "58000000",
  "1177115869",
  "283494994",
  "10401936118",
  "14996936118",
  "77949105",
  "743201500000",
  "504741",
  "225871125",
  "358271117",
  "99905340972",
  "99905340972",
  "386107454",
  "1102476248",
  "10000000",
  "265851672794",
  "265851672794",
  "24899378037",
  "24899378029",
  "5847273767",
  "5834409764",
  "192440000000",
  "2171936118",
  "15170000",
  "2966498993",
  "1000000000",
  "985000000",
  "185000000",
  "535000000",
  "10000000",
  "32575235",
  "98983503",
  "4351388293",
  "1773270000",
  "164923034",
  "491000000",
  "192337211",
  "128766336",
  "26000000",
  "1586000000",
  "234693504",
  "440000000",
  "435830000",
  "158118076",
  "6451353960"],
  decimalValues: [ "1022.69",
  "80.354713",
  "2000",
  "299.42485",
  "60",
  "108.593551",
  "399.778123",
  "600.084864",
  "739.589528",
  "836.279157",
  "8178.909472",
  "50000",
  "542",
  "5920.105",
  "1012.060192",
  "1090",
  "15985",
  "7039.63",
  "11893.726326",
  "680.98703",
  "30000",
  "930",
  "217700.859393",
  "10413.924106",
  "10413.924106",
  "12552.294821",
  "217700.859136",
  "1162.8629",
  "1124.726727",
  "1124.726727",
  "105.32",
  "1804.236553",
  "187729",
  "94.94",
  "187.989007",
  "7798.632226",
  "1000",
  "5959.974233",
  "1785098.93",
  "59.85",
  "747.2602",
  "1740.510996",
  "22523.57509",
  "7154.570226",
  "242",
  "216.79",
  "1990",
  "13578.234028",
  "5000",
  "450.45",
  "145.86649",
  "815.161604",
  "850",
  "7985",
  "15588.5595",
  "58",
  "1177.115869",
  "283.494994",
  "10401.936118",
  "14996.936118",
  "77.949105",
  "743201.5",
  "0.504741",
  "225.871125",
  "358.271117",
  "99905.340972",
  "99905.340972",
  "386.107454",
  "1102.476248",
  "10",
  "265851.672794",
  "265851.672794",
  "24899.378037",
  "24899.378029",
  "5847.273767",
  "5834.409764",
  "192440",
  "2171.936118",
  "15.17",
  "2966.498993",
  "1000",
  "985",
  "185",
  "535",
  "10",
  "32.575235",
  "98.983503",
  "4351.388293",
  "1773.27",
  "164.923034",
  "491",
  "192.337211",
  "128.766336",
  "26",
  "1586",
  "234.693504",
  "440",
  "435.83",
  "158.118076",
  "6451.35396"],
  averageValue: 54724.17091582278
}

const Streams: React.FC = () => {

  const [rawData, setRawData] = useState<StreamData>(initializeStreamData());
  const [rawD, setRawD] = useState<any>(null);

  useEffect(() => {
    const socket = io("http://18.223.123.138:5000", {
      transports: ["websocket"],
    });

    socket.on("connect", () => {
      console.log(`Socket connected: ${socket.id}`);
    });

    socket.on("USDT", (dataString) => {
      try{
        const data = JSON.parse(dataString);
      console.log("USDT", data);

      setRawD(data);
      if (data && data.time && Array.isArray(data.senders)) {
        setRawData(prevData => {
          const size = 100; 
          let newData = initializeStreamData();

          // Map over the incoming data and copy it to the new structure
          data.time.forEach((item: number, index: number) => {
            if (index < size) {
              newData.time[index] = item;
              newData.values[index] = data.values[index] || "0";
              newData.decimalValues[index] = data.decimalValues[index] || "0";
              newData.senders[index] = data.senders[index] || "";
              newData.receivers[index] = data.receivers[index] || "";
              // Calculate the average value if needed or use the one provided
              newData.averageValue = data.averageValue || prevData.averageValue;
            }
          });

          return newData;
        });
      }
      }
      catch (error) {
        console.error("Failed to parse data", error);
      }
    });

    // Clean up the effect by disconnecting the socket when the component unmounts
    return () => {
      socket.disconnect();
      console.log("Socket disconnected");
    };
  }, []); // The empty dependency array ensures the effect runs only once on mount

  return (
    <div>
        <section className="header-section">
          <Header />
        </section>
        <section className="streams-header-section">
      <h1 >Streams</h1>
      </section>
      {rawData && (
        <div>
          <h2>
          <DisplayStreamsData rawData={rawData} /> 
          <DisplayStreamsData rawData={testData} /> 
          {rawData && (
        <div>
          <h2>
            Received Data:<pre>{JSON.stringify(rawData, null, 2)}</pre>
          </h2>
        </div>
      )}
          </h2>
        </div>
      )}
    </div>
  );
};

export default Streams;